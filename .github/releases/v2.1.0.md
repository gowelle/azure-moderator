# Release Notes - v2.1.0

**Release Date:** 2025-12-18

---

## üéâ Release Highlights

This release introduces the **Multimodal API (Preview)** for combined text + image content analysis using Azure Content Safety's preview API.

> [!NOTE]
> **Preview API**: Uses `2024-09-15-preview` version. Feature availability varies by Azure region.

---

## ‚ú® Added

### Multimodal Content Analysis
- `MultimodalService` - Combined text + image analysis in a single API call
- `MultimodalResult` DTO - Result object with `isApproved()`, `isFlagged()`, `getSeverity()` methods
- `SafeMultimodal` validation rule - Validate uploaded images with context text
- `azure-moderator:test-multimodal` Artisan command for CLI testing
- Support for URL and base64 image encoding
- OCR text extraction from images (configurable via `enableOcr` parameter)

### Configuration
- New `multimodal` config section with `enabled` and `enable_ocr` options
- `AZURE_MODERATOR_MULTIMODAL_ENABLED` environment variable
- `AZURE_MODERATOR_MULTIMODAL_OCR` environment variable

### Tests
- 12 unit tests for `MultimodalService`
- 8 validation tests for `SafeMultimodal` rule
- 8 integration tests (skip gracefully when feature not available in region)

---

## üìñ Usage

### Service Usage
```php
use Gowelle\AzureModerator\MultimodalService;

$service = app(MultimodalService::class);

$result = $service->analyze(
    image: $base64ImageData,
    text: 'User-provided caption',
    encoding: 'base64',
    enableOcr: true
);

if ($result->isFlagged()) {
    echo $result->reason; // "High severity in: Violence"
}
```

### Validation Rule
```php
use Gowelle\AzureModerator\Rules\SafeMultimodal;

$request->validate([
    'image' => [
        'required',
        'image',
        new SafeMultimodal(
            text: $request->caption,
            categories: ['Sexual', 'Violence']
        )
    ],
]);
```

### CLI Testing
```bash
# Test with URL
php artisan azure-moderator:test-multimodal https://example.com/image.jpg --text="Caption"

# Test with local file
php artisan azure-moderator:test-multimodal ./path/to/image.jpg --local --text="Caption"
```

---

## üìä Technical Details

| Metric | Value |
|--------|-------|
| **Test Coverage** | 74 tests (unit + integration) |
| **Static Analysis** | PHPStan Level 6, 0 errors |
| **API Version** | `2024-09-15-preview` |
| **PHP Version** | 8.2+ required |
| **Laravel Version** | 10.0+ \| 11.0+ \| 12.0+ |

---

## ‚ö†Ô∏è Important Notes

### Region Availability
The Multimodal API is not available in all Azure regions. If you encounter a "not yet available in this region" error, check [Azure Content Safety region availability](https://learn.microsoft.com/en-us/azure/ai-services/content-safety/overview#region-availability).

### Preview API
This feature uses Azure's preview API (`2024-09-15-preview`). The API may change before general availability.

---

## üîó Links

- **Full Changelog**: https://github.com/gowelle/azure-moderator/compare/v2.0.0...v2.1.0
- **Documentation**: https://github.com/gowelle/azure-moderator#readme
- **Issues**: https://github.com/gowelle/azure-moderator/issues

---

## üì¶ Installation

```bash
composer require gowelle/azure-moderator:^2.1
```

## ‚¨ÜÔ∏è Upgrade

```bash
composer update gowelle/azure-moderator
```

No breaking changes - this is a fully additive release.

---

## üôè Contributors

Thanks to all contributors who made this release possible!

- [@gowelle](https://github.com/gowelle)
