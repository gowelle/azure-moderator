# Release Notes - v2.0.0

**Release Date:** 2025-12-18

---

## üéâ Release Highlights

This major release introduces **strongly-typed DTO responses**, **custom blocklists**, **protected material detection**, and **multi-modal batch moderation**.

> [!WARNING]
> **Breaking Change**: All moderation methods now return `ModerationResult` DTO objects instead of arrays. See Migration Guide below.

---

## ‚ú® Added

### Strongly-Typed DTOs
- `ModerationResult` - Main result object with `isApproved()`, `isFlagged()`, `getSeverity()` methods
- `CategoryAnalysis` - Individual category severity scores
- `BlocklistMatch` - Blocklist match details
- `ProtectedMaterialResult` - Protected material detection result

### Multi-Modal Content Analysis
- `moderateBatch()` - Process multiple items in one call
- `moderateWithContext()` - Analyze text + image together
- `ModerateContentJob` - Background queue processing
- `ContentModerated` event for async completion

### Custom Blocklists
- Full CRUD management via `BlocklistService`
- `azure-moderator:blocklist` Artisan command for CLI management
- Integration with `moderate()` method via `blocklistNames` parameter
- Configuration options for default blocklists

### Protected Material Detection
- `ProtectedMaterialService` for copyrighted text detection
- `SafeText` validation rule combining harmful content + protected material checks
- `azure-moderator:test-protected` Artisan command

---

## üîÑ Changed

- All moderation methods now return `ModerationResult` DTO instead of arrays
- Facade methods updated for DTO returns
- `lowRatingThreshold` configuration now supports float values
- Documentation updated with DTO examples

---

## üìä Technical Details

| Metric | Value |
|--------|-------|
| **Test Coverage** | 90+ tests (unit + integration + performance) |
| **Static Analysis** | PHPStan Level 6, 0 errors |
| **Performance** | 350-400ms average API response |
| **PHP Version** | 8.2+ required |
| **Laravel Version** | 10.0+ \| 11.0+ \| 12.0+ |

---

## ‚ö†Ô∏è Breaking Changes

### Array to DTO Response

All moderation methods now return `ModerationResult` DTO objects instead of associative arrays.

**Before (v1.x):**
```php
$result = AzureModerator::moderate($text, $rating);
if ($result['status'] === 'approved') {
    // Content is safe
}
$reason = $result['reason'];
```

**After (v2.0):**
```php
$result = AzureModerator::moderate($text, $rating);
if ($result->isApproved()) {
    // Content is safe
}
$reason = $result->reason;
```

---

## üîÑ Migration Guide

### From v1.3.x to v2.0.0

1. **Update status checks:**
   ```php
   // Before
   if ($result['status'] === 'approved') { ... }
   if ($result['status'] === 'flagged') { ... }
   
   // After
   if ($result->isApproved()) { ... }
   if ($result->isFlagged()) { ... }
   ```

2. **Update property access:**
   ```php
   // Before
   $reason = $result['reason'];
   $scores = $result['scores'];
   
   // After
   $reason = $result->reason;
   $scores = $result->categoriesAnalysis;
   ```

3. **Use helper methods:**
   ```php
   // Get severity for specific category
   use Gowelle\AzureModerator\Enums\ContentCategory;
   $severity = $result->getSeverity(ContentCategory::HATE);
   ```

4. **Convert to array if needed:**
   ```php
   // If you need array format for compatibility
   $array = $result->toArray();
   ```

---

## üìö Documentation

- [README](https://github.com/gowelle/azure-moderator#readme) - Updated with DTO examples
- [API Responses](docs/API_RESPONSES.md) - DTO response examples
- [Blocklists Guide](docs/BLOCKLISTS.md) - Custom blocklist management
- [Protected Material Guide](docs/PROTECTED_MATERIAL.md) - Copyrighted content detection
- [Integration Testing Guide](docs/INTEGRATION_TESTING.md) - Updated test examples

---

## üîó Links

- **Full Changelog**: https://github.com/gowelle/azure-moderator/compare/v1.3.0...v2.0.0
- **Documentation**: https://github.com/gowelle/azure-moderator#readme
- **Issues**: https://github.com/gowelle/azure-moderator/issues

---

## üì¶ Installation

```bash
composer require gowelle/azure-moderator:^2.0
```

## ‚¨ÜÔ∏è Upgrade

```bash
composer update gowelle/azure-moderator
```

After upgrading, update your code to use DTO syntax as described in the Migration Guide above.

---

## üôè Contributors

Thanks to all contributors who made this release possible!

- [@gowelle](https://github.com/gowelle)
